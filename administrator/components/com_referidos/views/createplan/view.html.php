<?php// No direct access to this filedefined('_JEXEC') or die('Restricted access'); // import Joomla view libraryjimport('joomla.application.component.view'); /** * HTML View class for the HelloWorld Component */class ReferidosViewCreatePlan extends JView{        private $plan;		private $model_plan;		public $items = array();		public $caract_item = array();		public $item = NULL;	        // Overwriting JView display method        function display($tpl = null)         {                // Assign data to the view                $this->model_plan = new ReferidosModelPlan();                 // Check for errors.                if (count($errors = $this->get('Errors')))                 {                        JError::raiseError(500, implode('<br />', $errors));                        return false;                }								//agregar toolbar				$this->addToolBar();								//obtener matriz				$this->getMatriz();								//obtengo los planes				$this->planes();	                // Display the view                parent::display($tpl);	        }				/**		 * Add the page title and toolbar.		 *		 * @since	1.6		 */		protected function addToolbar()		{			$id_edit = JRequest::getVar('id');				$user		= JFactory::getUser();			$canDo		= ReferidosHelper::getActions();						$text_crear = "Crear Plan";			if( !empty($id_edit) )$text_crear = "Editar Plan";				JToolBarHelper::title( 'GestiÃ³n Referidos : ' . $text_crear , 'planes' );						if ( $canDo->get('core.edit') || $canDo->get('core.create') ) {				JToolBarHelper::apply('plan.apply');				JToolBarHelper::save('plan.save');			}			if ( $canDo->get('core.create') && $canDo->get('core.manage') ) {				JToolBarHelper::save2new('plan.save2new');			}			if (empty($id_edit))  {				JToolBarHelper::cancel('plan.cancel');			} else {				JToolBarHelper::cancel('plan.cancel', 'JTOOLBAR_CLOSE');			}			JToolBarHelper::divider();			//JToolBarHelper::help('JHELP_USERS_USER_MANAGER_EDIT');		}				/**		* obtengo todos los planes activos creados;		*/		public function planes(){						$wheres = array(				0 => ( object ) array(						'key' => 'estado_activo'					,	'condition' => ' = '					,	'value' => '1'					,	'glue' => ''					)			);					$this->items = $this->model_plan->getObjects( $wheres );				}				/**		* obtener la matriz dependiendo del plan del usuario		*		*/		public function getMatriz(){						$id_plan = JRequest::getInt( 'id' );					$this->model_plan->instance( $id_plan );			$this->item = $this->model_plan;						if( !is_object( $this->item ) )					$this->item = ( object )array();						$wheres = array(				0 => ( object )array(						'key' => 'a.estado_activo'					,	'condition' => ' = '					,	'value' => '1'					,	'glue' => ''					)			);						$params = array(				'load' => 'loadObjectList'			);						$this->caract_item = $this->model_plan->getCaracteristicasPlan( $wheres , $params );			}				/**		* obtener las caracteristicas		*		*/		public function getCaracteristicas(){						$model_caracteristica = new ReferidosModelCaracteristica();						$wheres = array(				0 => ( object ) array(						'key' => 'estado_activo'					,	'condition' => ' = '					,	'value' => '1'					,	'glue' => ''					)				,				1 => ( object ) array(						'key' => ' ORDER BY'					,	'condition' => 'show_home'					,	'value' => ' DESC,  caracteristicas ASC'					,	'glue' => ''					)			);						$caracteristicas = $model_caracteristica->getObjects();						return $caracteristicas;		}		}