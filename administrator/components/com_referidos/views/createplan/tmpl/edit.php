<?php/** * @package		Joomla.Administrator * @subpackage	com_referidos * @copyright	Copyright (C) 2005 - 2013 Open Source Matters, Inc. All rights reserved. * @license		GNU General Public License version 2 or later; see LICENSE.txt */defined('_JEXEC') or die;// Load the tooltip behavior.JHtml::_('behavior.tooltip');JHtml::_('behavior.formvalidation');?><script>//Joomla.submitbutton = function(task){	if (task == 'plan.cancel' || document.formvalidator.isValid(document.id('item-form'))) {		Joomla.submitform(task, document.getElementById('item-form'));	}}</script><?php		$pos_plan = array();	$caract_ids = array();		foreach( $this->items as $key=>$plan){		$pos_plan[] = $plan->orden;	}	sort( $pos_plan );		//obtengo solo el id de las caracteristicas	foreach( $this->caract_item as $key=>$caracteristica ){		$caract_ids[] = $caracteristica->id_caracteristica;	}	?><form action="<?php echo JRoute::_('index.php?option=com_referidos&view=createplan&layout=edit&id=' .(int) $this->item->id_plan ); ?>" name="adminForm" id="item-form" class="form-validate form-createplan" method="post">	<fieldset class="adminform" id="campo_plan">    	<div class="width-60 fltlft">            <legend>Crear Plan</legend>            <label for="nombre">Nombre:</label>            <input type="text" name="nombre_plan" id="nombre_plan" value="<?php echo $this->item->nom_plan?>" class="required" />                        <label for="descripcion">Descripci贸n:</label>            <textarea name="descripcion" id="descripcion"><?php echo $this->item->descripcion?></textarea>                        <label for="disponibilidad">Disponibilidad:</label>            <select name="disponibilidad" id="disponibilidad">                <option value="1" <?php if( $this->item->estado_activo == '1' || empty( $this->item->estado_activo ) ){ echo 'selected="selected"';}?>>Disponible</option>                <option value="0" <?php if( $this->item->estado_activo == '0' ){ echo 'selected="selected"';}?>>No Disponible</option>            </select>                        <label for="niveles">Niveles:</label>            <input type="text" name="niveles" id="niveles" value="<?php echo $this->item->niveles?>" class="required validate-numeric" />                <label for="personasxnivel">Personas por Nivel:</label>            <input type="text" name="personasxnivel" id="personasxnivel" value="<?php echo $this->item->personas_nivel?>" class="required validate-numeric" />                        <label for="comisionxpersona">Comisi贸n por Persona:</label>            <input type="text" name="comisionxpersona" id="comisionxpersona" value="<?php echo $this->item->comision_x_persona?>" class="required validate-numeric" />                        <label for="orden">Orden:</label>            <select name="orden" id="orden">                <?php $i=0; do{                        $pos = ++$i;                    ?>                <option value="<?php echo $pos?>" <?php if( isset( $pos_plan[ $i ] ) && $pos_plan[ $i ] == $pos ){ echo 'disabled="disabled"';}?> ><?php echo $pos?></option>                <?php }while( $i < count( $pos_plan ) );?>            </select>            <label for="tipo_plan">Tipo Plan:</label>            <select name="tipo_plan" id="tipo_plan">            	<option value="1" <?php if( $this->item->tipo_plan == '1' ){ echo 'selected="selected"';}?>>Pago</option>                <option value="0" <?php if( $this->item->tipo_plan == '0' || empty( $this->item->tipo_plan ) ){ echo 'selected="selected"';}?>>Gratuito</option>            </select>            <label for="valorpesos">Valor Pesos:</label>            <input type="text" name="valorpesos" id="valorpesos" value="<?php echo $this->item->valor_pesos?>" class="required validate-numeric" />                        <label for="valordolar">Valor Dolar:</label>            <input type="text" name="valordolar" id="valordolar" value="<?php echo $this->item->valor_dolares?>" class="required validate-numeric" />                   <label for="caracteristicas">Caracteristicas</label>             <select name="caracteristicas" id="caracteristicas">                <option value="" data-nomcaract="">Seleccione Caracterestica</option>                <optgroup label="Home">                    <?php                     $caracteristicas = $this->getCaracteristicas();                        foreach( $caracteristicas as $key=>$caracteristica):                        if( $caracteristica->show_home == '1' ):                    ?>	                    <option id="ops-<?php echo $caracteristica->id_caracteristica?>" data-nomcaract="<?php echo $caracteristica->caracteristicas?>" value="<?php echo $caracteristica->id_caracteristica?>" <?php if( in_array( $caracteristica->id_caracteristica , $caract_ids) ){ echo 'disabled="disabled"';}?>><?php echo $caracteristica->caracteristicas?></option>                    <?php endif; endforeach; unset( $caracteristica );?>                </optgroup>                <optgroup label="No Home">                    <?php                     $caracteristicas = $this->getCaracteristicas();                                        foreach( $caracteristicas as $key=>$caracteristica):                        if( $caracteristica->show_home != '1' ):                    ?>	                    <option id="ops-<?php echo $caracteristica->id_caracteristica?>" data-nomcaract="<?php echo $caracteristica->caracteristicas?>" value="<?php echo $caracteristica->id_caracteristica?>" <?php if( in_array( $caracteristica->id_caracteristica , $caract_ids) ){ echo 'disabled="disabled"';}?>><?php echo $caracteristica->caracteristicas?></option>                    <?php endif; endforeach; unset( $caracteristica );?>                </optgroup>            </select>            <div class="content-field">                <label for="valorcaract">Valor:</label><input type="text" name="valorcaract" id="valorcaract" value="" />                <input type="button" name="addcat" id="addcat" value="Agregar" />            </div>        </div>        <div class="width-40 fltrt">        <table class="adminlist" id="valcaracteristicas">        	<thead>            	<tr>                	<th class="center">Caracteristica</th>                    <th class="center">Valor</th>                    <th class="center">&nbsp;</th>                </tr>            </thead>            <tbody>            	<?php foreach( $this->caract_item as $key=>$caract_item ):?>                	<tr>                    	<td class="center">                        	<input type="hidden" name="caracteristicasids[]" value="<?php echo $caract_item->id_caracteristica?>">                        	<input type="text" name="caracteristicanames[]" value="<?php echo $caract_item->caracteristicas?>" readonly="readonly"/>                       	</td>                        <td class="center"><input name="valor[]" value="<?php echo $caract_item->valor?>" readonly="readonly"/></td>                        <td class="center"><a href="#" class="elimina-caract" data-idops = "<?php echo $caract_item->id_caracteristica?>">Quitar</a></td>                    </tr>                <?php endforeach;?>            </tbody>        </table>        </div>        <input type="hidden" name="id" value="<?php echo (int) $this->item->id_plan?>" />	</fieldset>        <div class="clr"> </div>    <?php if( is_object($this->item) ):?>    <fieldset class="adminform">		<legend>Matriz</legend>        <div style="margin-bottom:9px;" class="datagrid gridmatriz">        <table class="adminlist">            <thead>                <tr>                    <th style="width:20%"><span>Nivel</span></th>                    <th style="width:20%"><span>Personas</span></th>                    <th style="width:30%"><span>Comisi贸n por Persona</span></th>                    <th style="width:30%"><span>Comisi贸n por nivel</span></th>                <tr>                </thead>        </table>        </div>        <div class="datagrid gridmatriz">            <table>                <tbody>                    <?php                        $niveles = ( int ) $this->item->niveles;                        $personas = $this->item->personas_nivel;                        $comi_nivel_total = array();                                                $per_pow = 0;                                            for( $i=0; $i < $niveles ; $i++):?>                              <tr>                        <td style="width:20%"><?php echo $i+1;?></td>                        <td style="width:20%"><?php if( $per_pow <= 0 ){ $per_pow = $personas; }else{ $per_pow = pow( $personas , $i+1 ); } echo $per_pow;?></td>                        <td style="width:30%"><?php echo '$ ' . number_format( $this->item->comision_x_persona , 2 , ',' ,'.');?></td>                        <td style="width:30%"><?php                             $comi_nivel_total[] = ( floatval( $per_pow )  * floatval( $this->item->comision_x_persona ) );                             echo '$ ' . number_format( ( floatval( $per_pow )  * floatval( $this->item->comision_x_persona ) ) , 2 , ',' , '.');                        ?></td>                    </tr>                    <?php endfor;?>                </tbody>                <tfoot>                    <tr>                        <td style="width:20%">&nbsp;</td>                        <td style="width:20%">&nbsp;</td>                        <td style="width:30%; font-weight:bold;">Total Comisi&oacute;n</td>                        <td style="width:30%; font-weight:bold;"><?php echo '$ '.number_format( array_sum( $comi_nivel_total ), 2 , ',' , '.');?></td>                    </tr>                </tfoot>            </table>        </div>    </fieldset>    <?php endif;?>            <div class="clr"> </div>	<input type="hidden" name="option" value="com_referidos" />	<input type="hidden" name="task" value="" />	<input type="hidden" name="boxchecked" value="0" />	<input type="hidden" name="controller" value="plan" /></form><div class="clr"></div>