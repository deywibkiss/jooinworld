<?php // No direct access to this filedefined('_JEXEC') or die('Restricted access');jimport( 'joomla.environment.uri' );$toolbar = CToolbarLibrary::getInstance();$uri = JFactory::getURI();$document = JFactory::getDocument();//style//script$document->addScriptDeclaration('	jQuery(document).ready(function() {        $("#org").jOrgChart({            chartElement : "#chart",            dragAndDrop  : false        });				//mostrar u ocultar las vistas arbol/lista		$( ".vista-seguimiento" ).click( function(e){						e.preventDefault();			var $elm = $( this );									var idVista = $elm.attr( "id" );			$( "#vista-organigrama , #vista-tabla" ).css( "display" , "none" );									if( idVista == "view-arbol" ){				$elm.find("i").removeClass( "treenoactive-icon" );				$elm.find("i").addClass( "treeactive-icon" );				$( "#view-lista" ).find( "i" ).removeClass( "gridactive-icon" );				$( "#view-lista" ).find( "i" ).addClass( "gridnoactive-icon" );								$( "#vista-organigrama" ).fadeIn( "fast" );				$( "#vistaref" ).val( "2" );			}			else{				$elm.find("i").removeClass( "gridnoactive-icon" );				$elm.find("i").addClass( "gridactive-icon" );				$( "#view-arbol" ).find( "i" ).removeClass( "treeactive-icon" );				$( "#view-arbol" ).find( "i" ).addClass( "treenoactive-icon" );								$( "#vista-tabla" ).fadeIn( "fast" );				$( "#vistaref" ).val( "1" );			}					});				//envio formulario desde el filtro del plan		$("")     });');$id_plan = JRequest::getVar( 'plan' , '');$nom_mail = JRequest::getVar( 'nom-mail' , '');//incluimos las dos barras de herramientasecho '<div id="community-wrap">'.$toolbar->getHTML().'</div>';$from = JRequest::getInt( 'from' , 0 );?><div class="content-referidos"><?php 	echo '<div class="content-barra"><h4>Seguimiento de Referidos</h4>' .ToolBarReferidos::render( 'Seguimiento de Referidos' ). '</div>';?>	<ul>    	<li><span>Miembros en mi Matríz: </span><span class="til-blue"><?php $allmiembros = ( count($this->ref_directos_all) + count($this->ref_indirectos_all) ); echo $allmiembros?></span></li>        <li><span>Miembros Directos: </span><span class="til-blue"><?php echo count( $this->ref_directos_all ); ?></span></li>        <li><span>Miembros Indirectos: </span><span class="til-blue"><?php echo count( $this->ref_indirectos_all ); ?></span></li>    </ul>    <?php 		//calculo la suma de los referidos directos e indirectos con el filtro		$miembrosfil = ( count( $this->ref_directos ) + count( $this->ref_indirectos ) ); 		$miembros_fil = array_merge( $this->ref_directos , $this->ref_indirectos);		//var_dump( $this->ref_indirectos );	?>    <form name="form-ref-filter" id="form-ref-filter" action="<?php echo JRoute::_('index.php?option=com_referidos&view=seguimientoreferidos' , false)?>" method="post" class="form-ref-filter">    	<ul class="filtrar-referidos">        	<li><h4 class="til-referidos">Buscar Miembro</h4></li>            <li><input type="text" name="nom-mail" id="nom-mail" placeholder="Nombre o Correo" value="<?php echo $nom_mail?>" /></li>            <li><input type="image" src="<?php echo $uri->root().'components/com_referidos/assets/images/lupa-icon.png'?>" alt="" /></li>            <li>            	<select name="plan" id="filter_plan" data-placeholder="Filtro por Plan">                	<option value="">Filtro por plan</option>                	<?php 					$planes = $this->planes();					foreach( $planes as $key=>$plan):					?>                	<option value="<?php echo (int) $plan->id_plan;?>" <?php if( $id_plan == $plan->id_plan){echo 'selected="selected"';}?>><?php echo $plan->nom_plan;?></option>                    <?php endforeach;?>                </select>            </li>        </ul>          <ul id="tipo-layout">        	<li><h4 class="til-referidos">Ver</h4></li>            <li><a href="#" class="vista-seguimiento" id="view-lista"><i class="jw-icon <?php echo ($this->vistaref == 1) ? 'gridactive-icon' : 'gridnoactive-icon';?>"></i></a></li>            <li><a href="#" class="vista-seguimiento" id="view-arbol"><i class="jw-icon <?php echo ($this->vistaref == 2) ? 'treeactive-icon' : 'treenoactive-icon';?>"></i></a></li>        </ul>        <input type="hidden" name="vistaref" id="vistaref" value="<?php echo $this->vistaref?>" />         </form>    <!--vista de los referidos en grilla-->    <div id="vista-tabla" <?php echo ( $this->vistaref != 1 ) ? 'style="display:none;"' : '';?>>        <div class="datagrid datagrid-head">            <table>                <thead>                    <tr>                        <th class="datagrid-center" style="width:20%"><span>Nombre</span></th>                        <th class="datagrid-center" style="width:40%"><span>Correo</span></th>                        <th class="datagrid-center" style="width:20%"><span>Fecha de Registro</span></th>                        <th class="datagrid-center" style="width:5%"><span>Generación</span></th>                        <th class="datagrid-center" style="width:15%"><span>Plan</span></th>                    <tr>                    </thead>            </table>        </div>        <!--vista de los referidos en lista-->        <div class="datagrid">            <table>                <tbody>                <!--Referidos all-->                <?php if( count( $miembros_fil ) > 0 ):					$hasta = ( count( $miembros_fil ) < 8 ) ? count( $miembros_fil ) : 8;				?>                <?php for( $i=$from; $i < ($from+$hasta) ; $i++ ):?>                    <tr <?php //if( ( $key % 2 ) == 0 ){ echo 'class="alt"'; } ?> >                        <td class="datagrid-pos datagrid-left" style="width:20%"><a href="index.php?option=com_community&view=profile&userid=<?php echo $miembros_fil[ $i ]->id;?>&Itemid=122"><?php echo $miembros_fil[ $i ]->name;?></a></td>                        <td class="datagrid-center" style="width:40%"><?php echo $miembros_fil[ $i ]->email;?></td>                        <td class="datagrid-center" style="width:20%"><?php if( !empty( $miembros_fil[ $i ]->registerDate ) ){ echo date( 'd-m-Y' , strtotime( $miembros_fil[ $i ]->registerDate )) ;}?></td>                        <td class="datagrid-center" style="width:5%"><?php echo $miembros_fil[ $i ]->nivel;?></td>                        <td class="datagrid-center" style="width:15%"><?php echo $miembros_fil[ $i ]->nom_plan;?></td>                    </tr>               	<?php endfor; endif;?>                 </tbody>            </table>            <!--Inicia el paginado-->            <div class="paginado-table">                <ul style="width:100%">                	<?php if( count( $miembros_fil ) > 8):?>                        <li><a href="index.php?option=com_referidos&view=seguimientoreferidos&from=<?php echo $from-8;?>">&lt;</a></li>                        <?php                         $contador = 1;                                                for( $i = 0 ; $i < count( $miembros_fil ); $i+=8):?>                        <li><a href="index.php?option=com_referidos&view=seguimientoreferidos&from=<?php echo $i;?>" class="num-paginado<?php if( $from == $i ){ echo ' pospagination';}?>"><?php echo $contador++;?></a></li>                        <?php endfor;?>                        <li><a href="index.php?option=com_referidos&view=seguimientoreferidos&from=<?php echo $from+8;?>">&gt;</a></li>                    <?php endif;?>                </ul>            </div>            <!--Finaliza el paginado-->        </div>	</div>    <!--vista de los referidos en arbol-->    <div id="vista-organigrama" <?php echo ( $this->vistaref != 2 ) ? 'style="display:none;"' : '';?>>    	<!--inicio organigrama-->        <ul id="org" style="display:none;">        <li>           <!--Aqui va el item del usuario logueado-->           <div class="user-main">           		<?php //var_dump($this->user_data); ?>                <img src="<?php echo ( !empty($this->user_data->thumb) ) ? $this->user_data->thumb : 'images/user-Male-thumb.png'; ?>" alt="<?php echo $this->user_data->name;?>" />                <ul>                	<li><span class="user_name"><a href="index.php?option=com_referidos&view=seguimientoreferidos&layout=infaccount"><?php echo $this->user_data->name;?></a></span></li>                    <li><?php echo $this->user_data->email;?></li>                    <li><?php echo date( 'd-m-Y' ,strtotime( $this->user_data->registerDate ) );?></li>                    <li><?php echo $this->user_data->nom_plan;?></li>                </ul>           </div>           <!--Empieza los items de los referidos-->           <ul>             <!--referidos directos-->             <?php foreach( $this->ref_directos as $key=>$directo):?>             <li>             	<div class="user-ref">                    <img src="<?php echo ( !empty($directo->thumb) ) ? $directo->thumb : 'images/user-Male-thumb.png'; ?>" alt="<?php echo $directo->name;?>" />                    <ul>                    	<li><span class="user_name"><a href="index.php?option=com_community&view=profile&userid=<?php echo $directo->userid?>&Itemid=122"><?php echo $directo->name?></a></span></li>                        <li><?php echo $directo->email;?></li>                        <li><?php echo date( 'd-m-Y' , strtotime( $directo->registerDate) );?></li>                        <li><?php echo $directo->nivel;?></li>                        <li><?php echo isset( $directo->nom_plan ) ? $directo->nom_plan : '';?></li>                    </ul>               </div>             <!--referidos indirectos-->               <?php $this->getRefRecursivo( $directo->userid , $this->ref_indirectos);?>             </li>             <?php endforeach;?>             <!--fin de referidos directos-->           </ul>         </li>       </ul>       <!--fin organigrama-->       <div id="chart" class="orgChart"></div>    </div>	           </div>