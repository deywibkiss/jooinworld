<?php // No direct access to this filedefined('_JEXEC') or die('Restricted access');$toolbar = CToolbarLibrary::getInstance();echo '<div id="community-wrap">'.$toolbar->getHTML().'</div>';$document = JFactory::getDocument();//obtengo una referencia de la clase Misc$Utilities = 'Misc';?><div class="content-referidos"><?php if( $this->tieneplan )	echo '<div class="content-barra"><h4>Mis Comisiones</h4>' .ToolBarReferidos::render( 'Mis Comisiones' ). '</div>';?>    <!-- info de comisiones-->    <?php 		$total_no_pagas = array();		$total_pagas = array();		$from = JRequest::getInt( 'from' , 0);		$conf_comision = $this->getConfComision();		$anio_act = date( 'Y' );		$mes_act = date( 'm' );				//corte primer periodo 		$diacorte1 = $conf_comision->dia_corte; $semama_corte1 = $conf_comision->semana_corte;			//corte segundo periodo			$diacorte2 = $conf_comision->dia_corte2; $semama_corte2 = $conf_comision->semana_corte2;				//pago primer periodo 		$diapago1 = $conf_comision->dia_pago; $semana_pago1 = $conf_comision->semana_pago;		//pago segundo periodo		$diapago2 = $conf_comision->dia_pago2; $semana_pago2 = $conf_comision->semana_pago2;				//obtengo los numeros de las semanas, especificandole el mes y a침o		$numSemanas = $Utilities::getWeeksMonth( $anio_act , $mes_act );		foreach($numSemanas as $key=>$numsem){			if( strlen( strval( $numsem ) ) < 2 )				$numSemanas[ $key ] = '0'.$numsem;		}		unset( $numsem );				//calcula la primera fecha de corte		$fecha_corte1 = $this->calculaNextDate( $numSemanas , $semama_corte1 , $diacorte1 );				//calcula la segunda fecha de corte		$fecha_corte2 = $this->calculaNextDate( $numSemanas , $semama_corte2 , $diacorte2 );					//calcular la proxima fecha de corte		if( strtotime( $fecha_corte1 ) > time() ){						$fecha_corte = $fecha_corte1;		}		elseif( strtotime( $fecha_corte2 ) > time() ){						$fecha_corte = $fecha_corte2;		}		else{						$fecha_corte = date( 'Y-m-d H:m:i' , strtotime( $fecha_corte1 .' +1 month' ) );		}				//calcula la primera fecha de pago		$fecha_pago1 = $this->calculaNextDate( $numSemanas , $semana_pago1 , $diapago1 ); 					//calcula la segunda fecha de pago		$fecha_pago2 = $this->calculaNextDate( $numSemanas , $semana_pago2 , $diapago2 ); 				//calcular la proxima fecha de pago		if( strtotime( $fecha_pago1 ) > time() ){						$fecha_pago = $fecha_pago1;		}		elseif( strtotime( $fecha_pago2 ) > time() ){						$fecha_pago = $fecha_pago2;		}		else{						$fecha_pago = date( 'Y-m-d H:m:i' , strtotime( $fecha_pago1 .' +1 month' ) );		}				//obtengo las comisiones pagadas y no pagadas		$no_pagas = $this->no_pagadas;		foreach( $no_pagas as $key=>$comision ){			$total_no_pagas[] = $comision->valor_comision;		}		unset( $comision );				$pagas = $this->pagadas;		foreach( $pagas as $key=>$comision ){			$total_pagas[] = $comision->valor_comision;		}		unset($comision);				$comosiones_all = array_merge( $no_pagas , $pagas );	?>    <ul>        <li>            <span class="data-til label-icon">Comisiones No Pagas:                <i class="jw-icon interroga-icon">                	<div class="icon-tooltip">Lorem ipsum dolor sit amet, veri ipsum eam ea, mel solum assum feugiat id.</div>                </i>            </span>            <span class="li-valor"><?php echo '$ '.number_format( array_sum( $total_no_pagas ) , 0 , ',' , '' );?></span>        </li>        <li>        	<span class="data-til label-icon">Pr칩xima Fecha de Corte:            	<i class="jw-icon interroga-icon">                	<div class="icon-tooltip">Lorem ipsum dolor sit amet, veri ipsum eam ea, mel solum assum feugiat id.</div>                </i>            </span>            <span  class="li-valor"><?php echo date( 'd/m/Y' , strtotime( $fecha_corte ) )?></span>       	</li>        <li>        	<span class="data-til label-icon">Pr칩xima Fecha de Pago:            	<i class="jw-icon interroga-icon">                	<div class="icon-tooltip">Lorem ipsum dolor sit amet, veri ipsum eam ea, mel solum assum feugiat id.</div>                </i>            </span>            <span  class="li-valor"><?php echo date( 'd/m/Y' , strtotime( $fecha_pago ) )?></span>        </li>        <li><span class="data-til label-icon til-blue">Total Acumulado:        		<i class="jw-icon interroga-icon">                	<div class="icon-tooltip">Lorem ipsum dolor sit amet, veri ipsum eam ea, mel solum assum feugiat id.</div>                </i>        	</span>            <span  class="li-valor til-bluebold"><?php echo '$ '.number_format( array_sum( $total_pagas ) , 0 , ',' , '.' );?></span>        </li>    </ul>    <h4 class="til-referidos">Hist칩rico de Comisiones</h4>   <div class="datagrid center datagrid-head">        <table>            <thead>                <tr>                    <th class="datagrid-center" style="width:35%"><span>Fecha de Corte</span></th>                    <th class="datagrid-center"  style="width:35%"><span>Valor</span></th>                    <th class="datagrid-center"  style="width:35%"><span>Estado</span></th>                <tr>                </thead>        </table>    </div>    <!--Historico de comisiones-->    <div class="datagrid center">        <table>            <tbody>            	<?php //if( count( $miembros_fil ) > 0 ):					$hasta = ( count( $comosiones_all ) < 6 ) ? count( $comosiones_all ) : 6;				?>            	<?php for( $i=$from; $i < ($from+$hasta); $i++):?>                <tr>                    <td class="datagrid-left" style="width:35%"><?php echo $comosiones_all[ $i ]->fecha_corte;?></td>                    <td class="datagrid-center" style="width:35%"><?php echo '$ '.number_format( $comosiones_all[ $i ]->valor_comision , 2, ',' ,'.' ); ?></td>                    <td style="width:35%">						<?php							if( $comosiones_all[ $i ]->estado_pago == '1'){									echo '<i class="jw-icon check-icon"></i>';							}else{								echo '<i class="jw-icon nocheck-icon"></i>';							}													?>                    </td>                </tr>                <?php endfor;?>            </tbody>        </table>        <div class="paginado-table">            <ul>            	<?php 				$contador = 1; 				if( count( $comosiones_all ) > 6):					for( $i=0; $i < count( $comosiones_all ) ; $i += 6):?>					<li><a href="index.php?option=com_referidos&view=miscomisiones&from=<?php echo $i?>" class="<?php if( $from == $i ){ echo 'pospagination';}?>"><?php echo $contador++;?></a></li>                <?php endfor; endif;?>            </ul>        </div>    </div></div>    