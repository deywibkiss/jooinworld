<?php defined( '_JEXEC' ) or die();jimport( 'joomla.application.component.view' );class ReferidosViewInvitar extends JView {	// Function that initializes the view		public $model_user;	protected $params_invt = '';		function display( $tpl = null ){				$this->model_user = new ReferidosModelUser();				//generar la invitaciÃ³n para el enlace		$this->generarInvitacion();			parent::display( $tpl );	}		public function getPlanesUser(){				$user = JFactory::getUser();				$wheres = array(			0 => ( object ) array(					'key' => 'b.estado_activo'				,	'condition' => ' = '				,	'value' => '1'				,	'glue' => 'AND'			)			,			1 => ( object ) array(					'key' => 'a.estado_plan'				,	'condition' => ' <> '				,	'value' => '0'				,	'glue' => ''			)		);				$params = array(			'group' => 'a.id_plan'		);				$this->model_user->instance( $user->get('id') );		return $this->model_user->getUserPlanes( $wheres , 	$params );	}		/*	* metodo que generar la invitacion para el enlace	*/	public function generarInvitacion(){				$app = JFactory::getApplication();		$this->params_invt = $app->getUserState( 'invita.paramsinvt' );				if( !empty($this->params_invt) )			return;					$model_invt = new ReferidosModelInvitado();		$model_user = new ReferidosModelUser();		$user = JFactory::getUser();		$Utilities = 'Misc';				$model_user->instance( (int) $user->get('id') );				$wheres_plan = array(			0 => (object) array(					'key' => 'a.estado_plan'				,	'condition' => ' = '				,	'value' => '1'				,	'glue' => ''			)			,			1 => (object) array(					'key' => 'b.estado_activo'				,	'condition' => ' = '				,	'value' => '1'				,	'glue' => ''			)		);		$params_plan = array(				'order' => 'a.fecha_adquiere DESC'			,	'load' => 'loadObject'		);		$lastplan = $model_user->getUserPlanes( $wheres_plan , $params_plan);				$args = array(				'id_invitado' => NULL			,	'id_user' => $user->get( 'id' )			,	'correo_invt' => ''			,	'nombre_invt' => NULL			,	'tipo_invt' => '3'			,	'fecha_invt' => date( 'Y-m-d H:i:s' )			,	'estado_invt' => '0'			,	'plan_invt' => $lastplan->id_plan		 );		 		 $model_invt->instance( $args );		 if( $model_invt->save( 'bool' ) ){			 			 $textencrypt = $model_invt->insertId.'_'.$model_invt->id_user.'_'.$model_invt->plan_invt;			 $this->params_invt = $Utilities::Encrypt( $textencrypt );			 $app->setUserState( 'invita.paramsinvt' , $this->params_invt );			 return;		 }		}}?>