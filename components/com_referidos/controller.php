<?php/** * @copyright	Copyright (C) 2005 - 2013 Open Source Matters, Inc. All rights reserved. * @license		GNU General Public License version 2 or later; see LICENSE.txt */defined('_JEXEC') or die('Restricted access');/** * Component Controller * * @package		Joomla.Administrator * @subpackage	com_referidos */class ReferidosController extends JControllerLegacy {	/**	 * @var		string	The default view.	 * @since	1.6	 */	protected $default_view = 'invitar';	/**	 * Method to display a view.	 *	 * @param	boolean			If true, the view output will be cached	 * @param	array			An array of safe url parameters and their variable types, for valid values see {@link JFilterInput::clean()}.	 *	 * @return	JController		This object to support chaining.	 * @since	1.5	 */	public function display( $cachable = false, $urlparams = false) {				//inlcuyo todos los modelos		$model_caracteristica = $this->getModel( 'caracteristica' );		$model_comision 	  = $this->getModel( 'comision' );		$model_comisiongen	  = $this->getModel( 'comisiongeneral' );		$model_confcomision	  = $this->getModel( 'confcomision' );		$model_invitado 	  = $this->getModel( 'invitado' );		$model_ordenplan	  = $this->getModel( 'ordenplan' );		$model_plan 		  = $this->getModel( 'plan' );		$model_referido 	  = $this->getModel( 'referido' );		$model_user 	      = $this->getModel( 'user' );		$model_userplan		  = $this->getModel( 'userplan' );				$view		= JRequest::getCmd('view', $this->default_view);		$layout 	= JRequest::getCmd('layout' , 'default');		$id			= JRequest::getInt('id');				//get document type		$document     = JFactory::getDocument();		$viewFormat   = $document->getType();				$user = JFactory::getUser();		//compruebo los planes activos del usuario		$model_user->instance( $user->get('id') );		$wheres_plan = array(			0 => (object) array(					'key' => 'b.estado_activo'				,	'condition' => ' = '				,	'value' => '1'				,	'glue' => 'AND'			)			,			1 => (object) array(					'key' => 'a.estado_plan'				,	'condition' => ' <> '				,	'value' => '0'				,	'glue' => ''			)			,			2 => (object) array(					'key' => 'b.tipo_plan'				,	'condition' => ' = '				,	'value' => '1'				,	'glue' => ''			)		);		$planes_user = $model_user->getUserPlanes( $wheres_plan );				/*		*se asigna a las vista una variable para comprobar 		*si el usuario tiene planes activos		*/		$tieneplan = true;		if( empty($planes_user) )$tieneplan = false;				$vista = $this->getView( $view , $viewFormat);		$vista->assign( 'tieneplan' , $tieneplan );		$vista->setLayout( $layout );				if( ( empty($planes_user) || $user->guest ) && $view != 'otroplan' ){			$this->setRedirect( JRoute::_('index.php?Itemid=142', false) );			return;		}				parent::display( $cachable, $urlparams );	}		/*private function renderSeguimiento(){				$view =& $this->getView( 'seguimientoreferidos' , 'html' );		$model =& $this->getModel( 'referido' );		$model_planes =& $this->getModel( 'plan' );		$model_user =& $this->getModel( 'user' );		$model_invitado =& $this->getModel( 'invitado' );	}		private function renderMisComisiones(){				$view =& $this->getView( 'miscomisiones' , 'html' );		$model =& $this->getModel( 'comision' );		$model_plan =& $this->getModel( 'plan' );	}*/}