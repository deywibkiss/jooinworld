/**** Event Handler for { Referidos }****/( function( $, window, document, controller, Utilities ){		var ReferidosHandler = function( a ){				// atributes, selector or global vars		this.importContFb = '.import-contacts-facebook';		this.filterPlan = '#filter_plan';		this.buttoninvitar = '#buttoninvitar';		this.forInvitar = '#form-invitar';		this.buttonInvitar = '#buttoninvitar';	};		ReferidosHandler.prototype ={						/**			 * Inializes the functions when DOM ready			 */				initialize: function(){								this.formValida();				this.getFacebook();				this.invitarContactFb();				this.filterPlanRef();							}						/**			* Inicializo configuracion de facebook			*/		,	getFacebook: function(){				$.ajaxSetup({ cache: true });				  $.getScript('//connect.facebook.net/en_UK/all.js', function(){						FB.init({						  appId: '1378479575748420',						  status: true,						  cookie: true,						  oauth: true,						  xfbml: false,						  frictionlessRequests : false						});     						$('#loginbutton,#feedbutton').removeAttr('disabled');										  });			}						/**			* validar formulario de invitacion			* @params{}			* @return{}			*/		,	formValida: function(){				$( this.buttonInvitar ).click( function(e){										e.preventDefault();										var pasaForm = true;					var data = Utilities.formToJson( '#form-invitar' );					var required = [ 'plan' , 'from' , 'sendto' ];					var errors = [];															errors = Utilities.validateEmptyFields( required, data, errors); 										$( '.invalid' ).removeClass( 'invalid' );					$( '.register-notification' ).hide();										//validos los emails introducidos por el usuario					var sendMails = data.sendto.split( ',' );					if( !($.isArray( sendMails )) )						sendMails = [ sendMails ];											for( var i=0 ; i < sendMails.length; i++){												sendMails[ i ] = Utilities.trim( sendMails[ i ] );												if( !Utilities.isEmail( sendMails[ i ] ) ){							$( '#sendto' ).addClass( 'invalid' );							$( '.register-notification' ).text( 'Los Email son incorrectos' ).show();							pasaForm = false;							break;						}					}										//valido los campos vacios					for( var i=0 ; i < errors.length ; i++){						$( '.register-notification' ).text( 'Llene los campos requeridos' ).show();						$( '#'+errors[ i ] ).addClass( 'invalid' );						pasaForm = false;					}										if( pasaForm )						$( '#form-invitar' ).submit();									});			}			/**			 * Function header			 *			 * @param {}			 * @return {}			 */		,	invitarContactFb: function(){							  var contactList = {}; 				  $( this.importContFb ).click( function( e ){													e.preventDefault();												var data = Utilities.formToJson( '#form-invitar' );						var required = [ 'plan' ];						var errors = [];						//console.log( data );												//validar los campos vacios						errors = Utilities.validateEmptyFields( required, data, errors); 												$( '.invalid' ).removeClass( 'invalid' );						for( var i=0 ; i < errors.length ; i++){							$( '#'+errors[ i ] ).addClass( 'invalid' );						}												//si hay campos vacios no dejar enviar el mensaje						if( errors.length < 1)						{							FB.getLoginStatus( function( response ){								if( response.status === 'connected'){																		controller.invitarContactFb( data );									return;																	}else{// login									FB.login(function(response) {										   if (response.authResponse) {												 console.log('Welcome!  Fetching your information.... ');												 controller.invitarContactFb( data );												 return;													} else {												console.log('User cancelled login or did not fully authorize.');										  	 }									 });																						}															});														}												});						}			/*			* filtrado por plan para seguimiento de referidos			*/			,	filterPlanRef: function(){						$( this.filterPlan ).change( function(e){								e.preventDefault();				var id_plan = $( this ).find( ':selected' ).val();				window.location.href = "index.php?option=com_referidos&view=seguimientoreferidos&plan=" + id_plan;			});		}						};		// Use this when the script is loaded in <head> tag	$( document ).ready( function(){		// Expose to global scope		window.ReferidosHandler = new ReferidosHandler();		window.ReferidosHandler.initialize();	});	})( jQuery, this, this.document, this.ReferidosController, this.Misc, undefined );